# Headless Visitor (Leapcell)

Service that an external cron (e.g., cron-job.org) hits every 15 minutes. It immediately returns `202`, then runs a **headless Playwright** browser that opens a target URL and **stays on that page for ~14 minutes**, then exits.

## Endpoints
- `GET /run?token=YOUR_SECRET[&url=ENCODED_URL]` – trigger a run (responds `202` immediately)
- `GET /status` – show last/active run status
- `GET /healthz` – simple health probe

## Environment Variables
- `CRON_SECRET` (required): shared secret for `/run`
- `TARGET_URL` (optional): default target if not provided via `?url=`
- `STAY_MINUTES` (optional, default `14`)
- `LAUNCH_TIMEOUT_MS` (optional, default `0` = no timeout)
- `PORT` (optional, default `8080`)
- `DEBUG` (optional: `pw:browser*` to see Playwright startup logs)

## Deploy on Leapcell
1. Connect this repo in Leapcell → Create Service (Node.js runtime).
2. **Build Command**: `sh prepare_playwright_env.sh && npm install`
   - This installs Chromium + OS deps at build time (critical for stability).
3. **Start Command**: `npm run start`
4. **Port**: `8080`
5. Set env vars: `CRON_SECRET`, optional `TARGET_URL`, `STAY_MINUTES=14`, `LAUNCH_TIMEOUT_MS=0`.
6. Deploy.

## Hook up cron-job.org (every 15 min)
Create a job that `GET`s:
